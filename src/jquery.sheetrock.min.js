/*!
 * jQuery Sheetrock v0.1.10
 * Quickly connect to, query, and lazy-load data from Google Spreadsheets
 * http://chriszarate.github.io/sheetrock/
 * License: MIT
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define("jquery.sheetrock",["jquery"],a):a(window.jQuery)}(function(a){"use strict";a.fn.sheetrock=function(a,b){return a.target=this,a=t(a),a&&(x(b)&&null!==b?g(a,b):f(a)),this};var b="https://spreadsheets.google.com/tq",c={loaded:{},failed:{},offset:{}},d={},e=0,f=function(b){a.fn.sheetrock.promise=a.fn.sheetrock.promise.pipe(function(){return h(b)}).pipe(function(){return i(b)})},g=function(a,b){k(a),o.call(a,b),l.call(a)},h=function(b){var c={sql:"select * limit 1",dataHandler:r,userCallback:a.noop,target:!1};return-1===b.sql.indexOf("%")||s(b)?a.Deferred().resolve():(y("Prefetching column labels."),i(a.extend({},b,c)))},i=function(b){k(b),b.callback="sheetrock_callback_"+e,e+=1;var c={data:j(b),context:b,url:b.server,dataType:"jsonp",cache:!0,jsonp:!1,jsonpCallback:b.callback};return y(c,b.debug),a.ajax(c).promise().done(o).fail(m).always(l)},j=function(a){var b={key:a.key,gid:a.gid,tqx:"responseHandler:"+a.callback};return a.sql&&(b.tq=D(a.sql,s(a))),b},k=function(b){b.loading.show(),a.fn.sheetrock.working=!0},l=function(){this.loading.hide(),a.fn.sheetrock.working=!1,this.userCallback(this)},m=function(){c.failed[this.requestID]=!0,y("Request failed.")},n=function(b,c){w(b,c)&&a.each(b[c],function(a,b){w(b,"detailed_message")?y(b.detailed_message):w(b,"message")&&y(b.message)})},o=function(a){if(n(a,"warnings"),n(a,"errors"),y(a,this.debug),w(a,"status","table")&&w(a.table,"cols","rows")){var b=p.call(this,a);this.dataHandler.call(b,a)}else m.call(this,a)},p=function(b){var d=this;return d.parsed={},d.parsed.last=d.chunkSize?Math.min(b.table.rows.length,d.chunkSize):b.table.rows.length,c.loaded[d.requestID]=!d.chunkSize||d.parsed.last<d.chunkSize,d.parsed.header=a.map(b.table.cols,B).length?1:0,d.parsed.labels=d.labels&&d.labels.length===b.table.cols.length?d.labels:a.map(b.table.cols,C),d},q=function(b){var c=this,d=c.target;a.extend(c,{thead:c.rowGroups?a("<thead/>").appendTo(d):d,tbody:c.rowGroups?a("<tbody/>").appendTo(d):d}),c.offset||c.headersOff||(c.parsed.header||!c.headers)&&c.thead.append(c.rowHandler({num:0,cells:F(c.parsed.labels)})),a.each(b.table.rows,function(b,d){if(w(d,"c")&&b<c.parsed.last){var e=v(c.offset+b+1+c.parsed.header-c.headers),f={num:e,cells:{}};(e||!c.headersOff)&&(a.each(d.c,function(a,b){var d=c.formatting?G(b):!1,e=b&&w(b,"v")?b.v:"";e instanceof Array&&(e=w(b,"f")?b.f:e.join("")),e=c.cellHandler(e),f.cells[c.parsed.labels[a]]=d?I(e,"span",d):e}),f.num?c.tbody.append(c.rowHandler(f)):c.thead.append(c.rowHandler(f)))}})},r=function(b){var c={};a.each(b.table.cols,function(a,b){c[b.id]=C(b)}),d[this.key+"_"+this.gid]=c},s=function(b){return a.isEmptyObject(b.columns)?d[b.key+"_"+b.gid]||!1:b.columns},t=function(b){return b=a.extend({},a.fn.sheetrock.options,b),b.key=z(b.url),b.gid=A(b.url),b.requestID=b.key+"_"+b.gid+"_"+b.sql,b.chunkSize=b.target.length?v(b.chunkSize):0,b.headers=v(b.headers),b.loading=E(b.loading),b.resetStatus&&(c.loaded[b.requestID]=!1,c.failed[b.requestID]=!1,c.offset[b.requestID]=0,y("Resetting request status.")),b.offset=c.offset[b.requestID]||0,b.chunkSize&&b.target&&(b.sql+=" limit "+(b.chunkSize+1),b.sql+=" offset "+b.offset,c.offset[b.requestID]=b.offset+b.chunkSize),b.target.length||b.dataHandler!==q?c.loaded[b.requestID]?y("No more rows to load!"):c.failed[b.requestID]?y("A previous request for this resource failed."):b.url?b.key?b.gid?(y(b,b.debug),b):y("Could not find a gid in the provided URL."):y("Could not find a key in the provided URL."):y("No spreadsheet URL provided."):y("No element targeted or data handler provided.")},u=function(a){return a.toString().replace(/^ +/,"").replace(/ +$/,"")},v=function(a){return Math.max(0,parseInt(a,10)||0)},w=function(a){for(var b=1;b<arguments.length;b+=1)if(!x(a[arguments[b]]))return!1;return!0},x=function(){for(var a=0;a<arguments.length;a+=1)if("undefined"==typeof arguments[a])return!1;return!0},y=function(a,b){return b=x(b,console)?b:!0,b&&console.log&&console.log(a),!1},z=function(a){var b=new RegExp("key=([^&#]+)","i");if(b.test(a))return a.match(b)[1];var c=new RegExp("spreadsheets/d/([^/#]+)","i");return c.test(a)?a.match(c)[1]:!1},A=function(a){var b=new RegExp("gid=([^/&#]+)","i");return b.test(a)?a.match(b)[1]:!1},B=function(a){return w(a,"label")?a.label.replace(/\s/g,""):null},C=function(a){return B(a)||a.id},D=function(b,c){return a.each(c,function(a,c){b=b.replace(new RegExp("%"+c+"%","g"),a)}),b},E=function(b){return!b||b instanceof a?b:a(b)},F=function(b){var c={};return a.each(b,function(a,b){c[b]=b}),c},G=function(a){return a&&w(a,"p")&&w(a.p,"style")?a.p.style:!1},H=function(a){var b,c="",d=a.num?"td":"th";for(b in a.cells)w(a.cells,b)&&(c+=I(a.cells[b],d,""));return I(c,"tr","")},I=function(a,b,c){var d=c?' style="'+c+'"':"";return"<"+b+d+">"+a+"</"+b+">"};a.fn.sheetrock.options={url:"",sql:"",server:b,chunkSize:0,columns:{},labels:[],rowHandler:H,cellHandler:u,dataHandler:q,userCallback:a.noop,loading:a(),headers:0,headersOff:!1,rowGroups:!0,formatting:!1,resetStatus:!1,debug:!1},a.fn.sheetrock.working=!1,a.fn.sheetrock.promise=a.Deferred().resolve(),a.fn.sheetrock.version="0.1.10"});
//# sourceMappingURL=jquery.sheetrock.min.map