!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("cross-fetch")):"function"==typeof define&&define.amd?define(["cross-fetch"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).sheetrock=e(t.fetch)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=e(t);const r={url:"",query:"",target:null,fetchSize:0,labels:[],rowTemplate:null,callback:null,reset:!1},o={sql:"query",resetStatus:"reset",chunkSize:"fetchSize",rowHandler:"rowTemplate"},n={2014:{apiEndpoint:"https://docs.google.com/spreadsheets/d/%key%/gviz/tq?",keyFormat:new RegExp("spreadsheets/d/([^/#]+)","i"),gidFormat:new RegExp("gid=([^/&#]+)","i")},2010:{apiEndpoint:"https://spreadsheets.google.com/tq?key=%key%&",keyFormat:new RegExp("key=([^&#]+)","i"),gidFormat:new RegExp("gid=([^/&#]+)","i")}};function i(t){let e=t?t.f||t.v||t:"";return e instanceof Array&&(e=e.join("")),"object"==typeof e?"":`${e}`.replace(/^\s+|\s+$/,"")}function a(t,e){return`<${e}>${t}</${e}>`}function l(t){const e=t.num?"td":"th";let s="";return Object.keys(t.cells).forEach((r=>{s+=a(t.cells[r],e)})),a(s,"tr")}class u extends Error{constructor(t="",e=null){super(),this.name="SheetrockError",this.code=e,this.message=t}}class c{constructor(t={},e=!1){this.user=function(t){const e={};if(e.target=function(t){let e=t;return"object"==typeof e&&e.jquery&&e.length&&([e]=e),e&&e.nodeType&&1===e.nodeType?e:null}(t.target),e.fetchSize=Math.max(0,parseInt(t.fetchSize,10)||0),!e.target&&!t.callback&&!r.callback)throw new u("No element targeted or callback provided.");return{...r,...t,...e}}(function(t){const e={};return Object.keys(t).forEach((s=>{!{}.hasOwnProperty.call(o,s)?e[s]=t[s]:e[o[s]]=t[s]})),e}(t)),this.request=function(t,e){if(e)return{data:e};let s=null;if(Object.keys(n).forEach((e=>{const r=n[e];r.keyFormat.test(t.url)&&r.gidFormat.test(t.url)&&(s=r)})),s){const e=t.url.match(s.keyFormat)[1];return{key:e,gid:t.url.match(s.gidFormat)[1],apiEndpoint:s.apiEndpoint.replace("%key%",e)}}throw new u("No key/gid in the provided URL.")}(this.user,e),this.requestIndex=`${this.request.key}_${this.request.gid}_${this.user.query}`}}const h={defaults:{failed:!1,header:0,labels:null,loaded:!1,offset:0},store:{}};class d{constructor(t){if(this.options=t,this.index=t.requestIndex,this.state.failed)throw new u("A previous request for this resource failed.");if(this.state.loaded)throw new u("No more rows to load!")}get state(){const t={}.hasOwnProperty.call(h.store,this.index),e=this.options.user.reset||this.options.request.data;if(!t||e){const e={labels:t?h.store[this.index].labels:null};h.store[this.index]={...h.defaults,...e}}return h.store[this.index]}get url(){const t=this.options.user.fetchSize,e=t?` limit ${t+1} offset ${this.state.offset}`:"",s=[`gid=${encodeURIComponent(this.options.request.gid)}`,`tq=${encodeURIComponent(this.options.user.query+e)}`];return this.options.request.apiEndpoint+s.join("&")}update(t={}){h.store[this.index]=Object.assign(this.state,t)}}class f{constructor(t,e,s){this.num=t,this.cellsArray=e.map(i),this.labels=s}get cells(){const t={};return this.labels.forEach(((e,s)=>{t[e]=this.cellsArray[s]})),t}}class p{constructor(t){this.request=t,this.options=t.options}setAttributes(){const{fetchSize:t}=this.options.user,{rows:e}=this.raw.table,{cols:s}=this.raw.table,r={last:e.length-1,rowNumberOffset:this.request.state.header||0};let o=this.request.state.labels;this.request.state.offset||(o=s.map(((t,s)=>t.label?t.label.replace(/\s/g,""):(r.last+=1,r.rowNumberOffset=1,i(e[0].c[s])||t.id))),this.request.update({header:r.rowNumberOffset,labels:o,offset:this.request.state.offset+r.rowNumberOffset})),(!t||e.length-r.rowNumberOffset<t)&&(r.last+=1,this.request.update({loaded:!0}));const n=this.options.user.labels,a=n&&n.length===o.length;r.labels=a?n:o,this.attributes=r}setOutput(){this.rows=[],this.request.state.offset||this.attributes.rowNumberOffset||this.rows.push(new f(0,this.attributes.labels,this.attributes.labels)),this.raw.table.rows.forEach(((t,e)=>{if(t.c&&e<this.attributes.last){const s=this.request.state.offset+e+1-this.attributes.rowNumberOffset;this.rows.push(new f(s,t.c,this.attributes.labels))}})),this.request.update({offset:this.request.state.offset+this.options.user.fetchSize})}setHTML(){const{target:t}=this.options.user,e=this.options.user.rowTemplate||l,s=(r=t)&&"TABLE"===r.tagName;var r;const o=t&&function(t,e){return-1!==` ${t.className} `.indexOf(` ${e} `)}(t,"sheetrock-header");let n="",i="";this.rows.forEach((t=>{t.num?i+=e(t):(s||o)&&(n+=e(t))})),s&&(n=a(n,"thead"),i=a(i,"tbody")),function(t,e){t&&t.insertAdjacentHTML&&t.insertAdjacentHTML("beforeEnd",e)}(t,n+i),function(t,e){if("function"==typeof Event){const s=new Event(e);t.dispatchEvent(s)}}(t,"sheetrock:loaded"),this.html=n+i}loadData(t,e){this.raw=t;try{this.setAttributes(),this.setOutput()}catch(t){return void e(new u("Unexpected API response format."))}this.setHTML(),e(null)}}let w=0;function b(t={},e=null){let r=null,o=null,n=null;function i(e){if(e&&"SheetrockError"===e.name&&o&&o.update&&o.update({failed:!0}),t.callback)t.callback(e,r,n);else if(e)throw e}try{r=new c({target:this,...t},!!e),o=new d(r),n=new p(o)}catch(t){i(t)}return e?n.loadData(e,i):r&&o&&n&&("object"==typeof window&&"document"in window?function(t,e){const s=window.document.getElementsByTagName("head")[0],r=window.document.createElement("script"),o=`_sheetrock_callback_${w}`;function n(){s.removeChild(r),delete window[o]}function i(){n(),e(new u("Request failed."))}w+=1,window[o]=function(s){n(),t.loadData(s,e)},r.addEventListener&&(r.addEventListener("error",i,!1),r.addEventListener("abort",i,!1)),r.type="text/javascript",r.src=`${t.request.url}&tqx=responseHandler:${o}`,s.appendChild(r)}
/*!
   * Sheetrock
   * Quickly connect to, query, and lazy-load data from Google Sheets.
   * https://chriszarate.github.io/sheetrock/
   * License: MIT
   */(n,i):function(t,e){s.default(t.request.url,{headers:{"X-DataSource-Auth":"true"}}).then((t=>{if(!t.ok)throw new u("Request failed.",t.status);return t.text()})).then((s=>{const r=JSON.parse(s.replace(/^\)]\}'\n/,""));t.loadData(r,e)})).catch((t=>{if(t instanceof u)return e(t);const s=t&&t.message?t.message:"Request failed.";return e(new u(s,500))}))}(n,i)),this}Object.assign(b,{defaults:r,version:"1.2.0"});try{window.jQuery.fn.sheetrock=b}catch(t){}return b}));
//# sourceMappingURL=sheetrock.min.js.map
